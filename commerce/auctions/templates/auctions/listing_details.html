{% extends "auctions/layout.html"%}
{% load crispy_forms_tags %}
{% load thumbnail %}


{% block body %}
<div class="listing">
    <p><strong>Auction Name:</strong> {{ listing.item_name }}</p>
    <p><strong>Posted in:</strong> {{ listing.posting_date }}</p>
    <p><strong>Base Price:</strong> {{ listing.base_price }}</p>
    <p><strong>Close Date:</strong> {{ listing.close_date }}</p>
    <p><strong>Posted by:</strong> {{ listing.user }}</p>
    <p><strong>Description:</strong> {{ listing.description }}</p>

    {% if listing.image %}
    {% thumbnail listing.image "200x200" crop="center" as im %}
    <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="image" />
    {% endthumbnail %}
    {% comment %}
    This else catch if the user did not upload image.
    {% endcomment%}
    {% else %}
    <img src="#" alt="No image available" />
    {% endif %}

        
       <h2>{{ bids.count }} bids</h2>
       <p><strong>Last bid: </strong>{{ last_bid }}</p>
       <div>
           {% if auction_is_closed %}
            <h4>This auction is closed on {{ listing.close_date }}</h4>
           {% endif %}
       </div>
        

        <form method="POST">
            {% csrf_token %}
            <div class="form-group row">
                <div class="col-lg-1">
                    {{ bid_form |crispy }}
                </div>
                 <div class="col-lg-1"></div>
                    <!-- Check if the bid reach close_date, then disable the text iput and button -->
                    <button type="submit" name="{{bid_form.prefix}}" class= "btn btn-primary bidBtn" {% if auction_is_closed %}disabled {% endif %}>Place bid</button> 
                </div>  
                <div class="col-lg-2">
                    <button type="submit" class="btn btn-link">Add To WatchList</button>
                </div>
             </div>
        </form>
       
    <div>
        <h2>{{ comments.count }} comments</h2>
        {% for comment in comments %}
        <div>
            <table>
                <tr>
                    <td><strong>{{ comment.user_name }}: </strong></td>
                    <td>{{ comment.content }}. &nbsp; </td>
                    <td>{{ comment.created_on}}</td>
                </tr>
            </table>
        </div>
        {% empty %}
        <p>There are no comments yet.</p>
        {% endfor %}
    </div>
    <!-- {% if new_comment %}
    <h2>Your comment has been added </h2>
    {% else %} -->
    <h3>Leave a comment </h3>
    <div id="commentSec">
        <form method="POST">
            {{ comment_form | crispy }}
            {% csrf_token %}
            <button type="submit" name="{{comment_form.prefix}}" class="btn btn-primary">Add comment</button>
        </form>
    </div>
    <!-- {% endif %} -->
</div>
{% endblock %}